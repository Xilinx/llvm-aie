// --- peel-itercount.c ---------------------------------------------------///
// NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
//
// This file is licensed under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
// (c) Copyright 2024 Advanced Micro Devices, Inc. or its affiliates
// --------------------------------------------------------------------------///

// RUN: %clang --target=aie2 -O2 -mllvm --unroll-force-peel-count=2 -S -emit-llvm %s -o - | FileCheck %s

// We force peeling by two. We check thatthe two blocks have been added
// and that the itercounts have been updated appropriately

// CHECK-LABEL: loop28_37
// CHECK: for.body.preheader:
// CHECK: for.body.peel.next:
// CHECK: !llvm.loop !6
// CHECK: !6 = distinct !{!6, !7, !8, !9}
// CHECK: !7 = !{!"llvm.loop.peeled.count", i32 2}
// CHECK: !8 = !{!"llvm.loop.itercount.range", i32 26, i32 35}
// CHECK: !9 = !{!"llvm.loop.unroll.disable"}

int loop28_37(int n, int *p) {
  int s = 0;
#pragma clang loop min_iteration_count(28)
#pragma clang loop max_iteration_count(37)
  for (int i = 0; i < n; i++) {
    s += p[i];
  }

  return s;
}

