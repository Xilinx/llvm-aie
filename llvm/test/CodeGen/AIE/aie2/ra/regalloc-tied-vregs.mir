# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
#
# This file is licensed under the Apache License v2.0 with LLVM Exceptions.
# See https://llvm.org/LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
#
# (c) Copyright 2023-2024 Advanced Micro Devices, Inc. or its affiliates
# RUN: llc -mtriple=aie2 -verify-machineinstrs --run-pass=regallocfast %s -o - | FileCheck %s --check-prefix=FAST
# RUN: llc -mtriple=aie2 -verify-machineinstrs --run-pass=greedy,virtregrewriter %s -o - | FileCheck %s --check-prefix=GREEDY

# Ensure both reg allocs keep the registers tied, and correctly rewrite the
# implicit uses in PseudoRET.
---
name:            test_padd_3d
alignment:       16
legalized:       true
regBankSelected: true
selected:        true
tracksRegLiveness: true
body:             |
  bb.0.entry:
    liveins: $d0_3d, $p0
    ; FAST-LABEL: name: test_padd_3d
    ; FAST: liveins: $d0_3d, $p0
    ; FAST-NEXT: {{  $}}
    ; FAST-NEXT: $p0, $dc0, $dc4 = PADDA_3D $p0, $d0_3d
    ; FAST-NEXT: PseudoRET implicit $lr, implicit killed renamable $p0, implicit renamable $dc0, implicit killed $d0_3d
    ; GREEDY-LABEL: name: test_padd_3d
    ; GREEDY: liveins: $p0, $d0_3d
    ; GREEDY-NEXT: {{  $}}
    ; GREEDY-NEXT: $p0, $dc0, $dc4 = PADDA_3D killed $p0, $d0_3d
    ; GREEDY-NEXT: PseudoRET implicit $lr, implicit killed renamable $p0, implicit killed renamable $dc4, implicit renamable $dc0
    %0:eds = COPY $d0_3d
    %100:ep = COPY $p0
    %100:ep, %0.sub_dim_count:eds, %0.sub_hi_dim_then_sub_dim_count:eds = PADDA_3D %100, %0
    PseudoRET implicit $lr, implicit %100, implicit %0.sub_hi_dim_then_sub_dim_count, implicit %0.sub_dim_count
...
