; This file is licensed under the Apache License v2.0 with LLVM Exceptions.
; See https://llvm.org/LICENSE.txt for license information.
; SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
;
; (c) Copyright 2024 Advanced Micro Devices, Inc. or its affiliates

; RUN: not --crash llc -mtriple=aie2 -O0 -stop-after=legalizer -verify-machineinstrs %s -o - 2>&1 | FileCheck %s

; Code generated by clang at O0 cannot be compiled when passing 128-bit vectors due to failure in legalization.
; as pre-legalizer combiner is not run at O0.  
define dso_local void @test_call_v4i32(<4 x i32> noundef %0) {
entry:
  ; CHECK: LLVM ERROR: unable to legalize instruction: %0:_(<4 x s32>), %2:_(<4 x s32>) = G_UNMERGE_VALUES %1:_(<8 x s32>)
  %.addr = alloca <4 x i32>, align 16
  store <4 x i32> %0, ptr %.addr, align 16
  ret void
}
