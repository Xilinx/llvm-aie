# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
#
# This file is licensed under the Apache License v2.0 with LLVM Exceptions.
# See https://llvm.org/LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
#
# (c) Copyright 2023-2024 Advanced Micro Devices, Inc. or its affiliates
# RUN: not --crash llc -mtriple aie2 -run-pass=instruction-select -run-pass=liveintervals -verify-machineinstrs -o /dev/null %s 2>&1 | FileCheck %s

# %4 is used before being defined which is wrong.
# This is fixed in a follow-up commit.
---
name:            VLD_UPS_use_before_def
legalized:       true
regBankSelected: true
tracksRegLiveness: true
body: |
  bb.0:
    liveins: $p0, $m0, $m1, $m2, $r0
    ; CHECK: Use of %4 does not have a corresponding definition on every path:
    ; CHECK-NEXT: 64r $m1 = COPY %4:ep
    ; CHECK-NEXT: LLVM ERROR: Use not jointly dominated by defs.
    %0:ptrregbank(p0) = COPY $p0
    %7:modregbank(s20) = COPY $m0
    %70:gprregbank(s32) = COPY $r0
    %25:vregbank(<16 x s16>), %19:ptrregbank(p0) = G_AIE_POSTINC_LOAD %0, %7 :: (load (<16 x s16>))
    $m1 = COPY %19:ptrregbank(p0)
    %12:ptrregbank(p0) = COPY $m1
    %103:accregbank(<8 x s64>) = G_INTRINSIC intrinsic(@llvm.aie2.acc64.v16.I256.ups), %25:vregbank(<16 x s16>),  %70:gprregbank(s32),  %70:gprregbank(s32)
    PseudoRET implicit $lr, implicit %103, implicit %12
...
